<h1 class="mb-3">๐ฎโโ๏ธ ะะฐะฝะตะปั ะัะฝะบัั ัะฟัะฐะฒะปัะฝะฝั</h1>
<p class="text-muted">ะััะฐัะผะพ, <strong><%= user.login %></strong>!</p>

<hr>
<h3 class="mb-4">๐ ะััะฐะฝะฝั ะทะฒะตะดะตะฝั ัะพะทัะพะดะธ</h3>

<%
  function formatUkrainianDate(dateInput) {
    const dateStr = typeof dateInput === 'string'
      ? dateInput
      : new Date(dateInput).toISOString().split('T')[0];

    const [year, month, day] = dateStr.split("-");
    const months = [
      "ัััะฝั", "ะปััะพะณะพ", "ะฑะตัะตะทะฝั", "ะบะฒััะฝั", "ััะฐะฒะฝั", "ัะตัะฒะฝั",
      "ะปะธะฟะฝั", "ัะตัะฟะฝั", "ะฒะตัะตัะฝั", "ะถะพะฒัะฝั", "ะปะธััะพะฟะฐะดะฐ", "ะณััะดะฝั"
    ];
    const monthName = months[parseInt(month, 10) - 1];
    return `${parseInt(day, 10)} ${monthName} ${year} ั.`;
  }
%>

<div class="row g-4">
  <% summaries.forEach(function(summary) { %>
    <div class="col-md-6 col-xl-4">
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">
            ๐ <%= formatUkrainianDate(summary.summary_date) %>
          </h5>

          <p class="card-text">
            ๐ฅ <strong>ะัะธัััะฝั:</strong> <%= summary.present_count %><br>
            โ <strong>ะัะดัััะฝั:</strong> <%= summary.absent_count %>
          </p>

          <% if (summary.location_name) { %>
            <span class="badge bg-info mb-2 text-dark">๐ ะะพะบะฐััั: <%= summary.location_name %></span>
          <% } else if (summary.location_id) { %>
            <span class="badge bg-info mb-2 text-dark">๐ ะะพะบะฐััั โ<%= summary.location_id %></span>
          <% } else if (summary.faculty_name) { %>
            <span class="badge bg-primary mb-2 text-wrap">๐ ะคะฐะบัะปััะตั: <%= summary.faculty_name %></span>
          <% } else if (summary.faculty_id) { %>
            <span class="badge bg-primary mb-2">๐ ะคะฐะบัะปััะตั โ<%= summary.faculty_id %></span>
          <% } else { %>
            <span class="badge bg-secondary mb-2">โ ะะตะฒัะดะพะผะต ะดะถะตัะตะปะพ</span>
          <% } %>

          <% if (summary.reasons && summary.reasons.length > 0) { %>
            <p class="fw-bold mt-2 mb-1">ะัะธัะธะฝะธ ะฒัะดัััะฝะพััั:</p>
            <ul class="mb-3 ps-3">
              <% summary.reasons.forEach(function(r) { %>
                <li><%= r.reason %>: <%= r.count %></li>
              <% }) %>
            </ul>
          <% } else { %>
            <p class="text-muted mt-2">ะัะธัะธะฝะธ ะฝะต ะฒะบะฐะทะฐะฝั</p>
          <% } %>

          <div class="mt-auto">
            <form action="/pu/export/<%= summary.id %>" method="GET">
              <button class="btn btn-sm btn-outline-primary w-100" type="submit">
                ๐งพ ะะบัะฟะพัััะฒะฐัะธ ั Word
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>
  <% }) %>
</div>
